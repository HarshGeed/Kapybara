## Kapybara Blog (Next.js + tRPC + Drizzle)

Clean, minimal blog platform with posts, categories, filtering, and a simple dashboard. Built with Next.js App Router, tRPC, Drizzle ORM, and Tailwind CSS.

### Live Deployment

- URL: https://kapybara.vercel.app/

### Tech Stack

- **Framework**: Next.js 16 (App Router)
- **Frontend**: React 19, Tailwind CSS 4
- **Data Fetching/Cache**: TanStack Query
- **API**: tRPC v11 (type-safe procedures)
- **ORM**: Drizzle ORM + drizzle-kit
- **Database**: Postgres (Neon serverless recommended)
- **Validation**: Zod

---

## Features

- **Priority 1 (Core)**
  - [x] Blog post CRUD (create, read, update, delete)
  - [x] Category CRUD
  - [x] Assign one or more categories to posts
  - [x] Blog listing page showing all posts
  - [x] Individual post page
  - [x] Category filtering on listing page
  - [x] Basic responsive navigation
  - [x] Clean, professional UI

- **Priority 2 (Should Have)**
  - [x] Landing page with 3 sections (hero, recent posts, all posts)
  - [x] Dashboard for managing posts and categories
  - [x] Draft vs Published status
  - [x] Loading and error states
  - [x] Mobile-responsive design
  - [x] Content editor with markdown or rich text
 
- **Priority 3 (Bonus Features)**
  - [x] Pagination

---

## Project Structure

- `app/` Next.js App Router pages
  - `app/page.tsx` Home (landing + recent/all posts, create shortcut)
  - `app/blog/page.tsx` Blog listing with category filter and pagination
  - `app/blog/[slug]/page.tsx` Single post page
  - `app/dashboard/page.tsx` Simple CMS dashboard (posts + categories)
  - `app/api/trpc/[trpc]/route.ts` tRPC HTTP handler
- `components/` UI components (forms, nav, providers)
- `server/db/` Drizzle setup and schema
- `server/trpc/` tRPC routers and root `appRouter`
- `utils/trpc.ts` tRPC React client factory

---

## tRPC Router Structure

Root router: `server/trpc/index.ts`

- `post` router: `server/trpc/routers/post.ts`
  - `create` (mutation): create post with optional `categoryIds[]`
  - `getAll` (query): all posts (dashboard)
  - `getAllPublished` (query): published posts only
  - `getPaginated` (query): published posts with optional `categoryId` filter and pagination
  - `getBySlug` (query): single published post by slug
  - `update` (mutation): update title/content/published and regenerate slug
  - `delete` (mutation): delete by id
  - `getCategoriesByPostId` (query)
  - `getCategoriesBySlug` (query)

- `category` router: `server/trpc/routers/category.ts`
  - `create` (mutation): create category; slug autogenerated from name
  - `getAll` (query)
  - `update` (mutation): update name/description; slug regenerates when name changes
  - `delete` (mutation)

Procedure helpers and error formatting are defined in `server/trpc/trpc.ts`.

---

## Database Schema (Drizzle)

- `categories(id, name, description, slug, created_at)`
- `posts(id, title, content, slug, published, created_at, updated_at)`
- `post_categories(post_id, category_id)` composite PK, cascade deletes

Configured in `server/db/schema.ts`. Postgres URL is read from `DATABASE_URL`.

---

## Quickstart (Local Development)

1) Clone and install

```bash
git clone <repo-url>
cd kapybara
npm install
```

2) Environment variables

Create `.env.local` in the project root:

```bash
DATABASE_URL="postgresql://user:password@host:port/dbname?sslmode=require"
```

Notes:
- Neon serverless Postgres is recommended. Ensure SSL is enabled (e.g., `?sslmode=require`).
- The same `DATABASE_URL` must be configured in Vercel for production.

3) Database setup (Drizzle)

```bash
npm run db:generate   # generate migrations from schema
npm run db:push       # push schema to the database
# optional UI
npm run db:studio     # open Drizzle Studio (CRUD UI)
```

4) Run the app

```bash
npm run dev
# open http://localhost:3000
```

---

## Seeding the Database

Choose one of the following:

- Dashboard UI (easiest)
  - Go to `/dashboard`
  - Create a few categories
  - Create posts and select categories, set Published when ready

- Drizzle Studio
  - Run `npm run db:studio`
  - Insert rows into `categories` and `posts`, then create links in `post_categories`

- SQL (via Neon console or `psql`)
  - Insert categories into `categories`
  - Insert posts into `posts`
  - Insert relationships into `post_categories(post_id, category_id)`

---

## Deployment (Vercel)

1) Push the repo to GitHub
2) Import the project in Vercel and select this repository
3) Add environment variable in Vercel Project Settings:
   - `DATABASE_URL`
4) Deploy

No additional server config is required; tRPC is served via `app/api/trpc/[trpc]/route.ts`.

---

## Environment Variables

- `DATABASE_URL` (required): Postgres connection string used by Drizzle and Neon client

No other environment variables are required.

---

## Available Scripts

```bash
npm run dev        # start dev server
npm run build      # production build
npm run start      # start production server
npm run lint       # run eslint
npm run db:generate
npm run db:push
npm run db:studio
```

---

## Trade-offs & Decisions

- Simplicity over bells and whistles: forms use React-Markdown library for simple markdown to keep UI lean and focus on CRUD flows.
- Serverless Postgres (Neon) for frictionless DX; Drizzle for type-safe queries and clear schema.
- Public tRPC procedures only; no auth layer included to keep scope minimal. Add middleware in `server/trpc/trpc.ts` when needed.
- Slugs regenerate on title/name updates, which can change URLs. In production you might want slug immutability or redirects.


